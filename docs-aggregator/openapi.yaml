openapi: 3.1.0
info:
  title: Budget Analyzer - Unified API
  version: '1.0'
  description: Unified API documentation for all Budget Analyzer microservices. This
    specification combines the Budget Analyzer API and Currency Service into a single
    document for client code generation.
  contact:
    name: Bleu Rubin
    email: support@bleurubin.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
- url: http://localhost:8080/api
  description: Local environment (via gateway)
- url: https://api.bleurubin.com
  description: Production environment
tags:
- name: Transactions
  description: Import and manipulate transactions
  x-service: budget-analyzer-api
- name: Currency Handler
  description: Endpoints for operations on currencies
  x-service: currency-service
- name: Exchange Rates Handler
  description: Endpoints for operations on exchange rates
  x-service: currency-service
paths:
  /v1/transactions/search:
    post:
      tags:
      - Transactions
      summary: Search transactions
      description: Paginated search over transactions
      operationId: searchTransactions
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionFilter'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transaction'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INVALID_REQUEST
                message: Bad Request
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
  /v1/transactions/import:
    post:
      tags:
      - Transactions
      summary: Upload CSV file(s) containing transactions
      description: Imports transactions from one or more CSV files for a given account
        and format.
      operationId: importTransactions
      parameters:
      - name: format
        in: query
        description: CSV format type
        required: true
        schema:
          type: string
        example: capital-one
      - name: accountId
        in: query
        description: Account ID to associate transactions with
        required: false
        schema:
          type: string
        example: checking-12345
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  description: CSV file(s) to upload
                  items:
                    type: string
                    format: binary
              required:
              - files
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transaction'
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              examples:
                CSV Parsing Error:
                  summary: Missing required column
                  description: CSV Parsing Error
                  value:
                    type: APPLICATION_ERROR
                    message: Missing value for required column 'Transaction Description'
                      at line 1 in file 'bkk-bank-2025.csv'
                    code: CSV_PARSING_ERROR
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INVALID_REQUEST
                message: Bad Request
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
  /v1/transactions:
    get:
      tags:
      - Transactions
      summary: Get transactions
      description: Get all transactions
      operationId: getTransactions
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transaction'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
  /v1/transactions/{id}:
    get:
      tags:
      - Transactions
      summary: Get transaction
      description: Get transaction by id
      operationId: getTransaction
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: NOT_FOUND
                message: Not Found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
    delete:
      tags:
      - Transactions
      summary: Delete transaction
      description: Delete transaction by id
      operationId: deleteTransaction
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '204':
          description: No Content
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: NOT_FOUND
                message: Not Found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
  /v1/exchange-rates:
    get:
      tags:
      - Exchange Rates Handler
      summary: Get exchange rates
      description: Get exchange rates for converting USD to the target currency
      operationId: getExchangeRates
      parameters:
      - name: startDate
        in: query
        description: Start date for exchange rates in ISO format
        required: false
        schema:
          type: string
          format: date
        example: '2024-01-01'
      - name: endDate
        in: query
        description: End date for exchange rates in ISO format
        required: false
        schema:
          type: string
          format: date
        example: '2024-12-31'
      - name: targetCurrency
        in: query
        description: Target currency of exchange rate
        required: true
        schema:
          type: string
        example: THB
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ExchangeRateResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
  /v1/exchange-rates/import:
    get:
      tags:
      - Exchange Rates Handler
      summary: Import latest available rates from FRED
      description: Retrieve latest un-imported exchange rates from FRED- manually
        triggers daily cron job
      operationId: importLatestExchangeRates
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportResultResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
  /v1/currencies:
    get:
      tags:
      - Currency Handler
      summary: Get supported currencies
      description: Get a list of currencies that have exchange rate data
      operationId: getSupportedCurrencies
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: INTERNAL_ERROR
                message: Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                type: SERVICE_UNAVAILABLE
                message: Service Unavailable
components:
  schemas:
    TransactionFilter:
      type: object
      description: Filter for querying transactions by various fields
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier for the transaction
          example: 1
        accountId:
          type: string
          description: Identifier for the account associated with the transaction
          example: checking-3223
        bankName:
          type: string
          description: Name of the bank where the transaction occurred
          example: Capital One
        dateFrom:
          type: string
          format: date
          description: Start date for transaction date range
          example: '2025-10-01'
        dateTo:
          type: string
          format: date
          description: End date for transaction date range
          example: '2025-10-14'
        currencyIsoCode:
          type: string
          description: ISO currency code for the transaction
          example: USD
        minAmount:
          type: number
          description: Minimum transaction amount
          example: 10.0
        maxAmount:
          type: number
          description: Maximum transaction amount
          example: 500.0
        type:
          type: string
          description: Type of the transaction
          enum:
          - CREDIT
          - DEBIT
          example: DEBIT
        description:
          type: string
          description: Text to match in the transaction description
          example: Grocery
        createdAfter:
          type: string
          format: date-time
          description: Start of creation timestamp range
          example: '2025-10-14T00:00:00Z'
        createdBefore:
          type: string
          format: date-time
          description: End of creation timestamp range
          example: '2025-10-15T00:00:00Z'
        updatedAfter:
          type: string
          format: date-time
          description: Start of last update timestamp range
          example: '2025-10-14T00:00:00Z'
        updatedBefore:
          type: string
          format: date-time
          description: End of last update timestamp range
          example: '2025-10-15T00:00:00Z'
    Transaction:
      type: object
      description: Transaction entity representing a financial transaction
      properties:
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        deleted:
          type: boolean
        deletedAt:
          type: string
          format: date-time
        id:
          type: integer
          format: int64
          description: Unique identifier for the transaction
          example: 1
        accountId:
          type: string
          description: Identifier for the account associated with the transaction
          example: checking-3223
        bankName:
          type: string
          description: Name of the bank where the transaction occurred
          example: Capital One
        date:
          type: string
          format: date
          description: Date of the transaction
          example: '2025-10-14'
        currencyIsoCode:
          type: string
          description: ISO currency code for the transaction
          example: USD
        amount:
          type: number
          description: Amount of the transaction
          example: 100.5
        type:
          type: string
          description: Type of the transaction
          enum:
          - CREDIT
          - DEBIT
          example: DEBIT
        description:
          type: string
          description: Description of the transaction
          example: Grocery shopping
      required:
      - amount
      - bankName
      - currencyIsoCode
      - date
      - description
      - id
      - type
    ApiErrorResponse:
      description: Standard API error response format
      properties:
        type:
          type: string
          description: Error type categorization for API responses
          enum:
          - INVALID_REQUEST
          - VALIDATION_ERROR
          - NOT_FOUND
          - APPLICATION_ERROR
          - SERVICE_UNAVAILABLE
          - INTERNAL_ERROR
          example: APPLICATION_ERROR
        message:
          type: string
          description: Human-readable message describing the error
          example: 'CSV format: fake-bank not supported'
        code:
          type: string
          description: Machine-readable error code for specific application errors
            (required for APPLICATION_ERROR type)
          example: CSV_PARSING_ERROR
        fieldErrors:
          type: array
          description: List of field-level validation errors (populated for VALIDATION_ERROR
            type)
          items:
            $ref: '#/components/schemas/FieldError'
      required:
      - message
      - type
    FieldError:
      description: Field-level validation error details
      properties:
        field:
          type: string
          description: Field that triggered the error
          example: email
        message:
          type: string
          description: Error message
          example: must be a valid email address
        rejectedValue:
          type: object
          description: Value that caused the error
          example: invalid@email
      required:
      - field
      - message
      - rejectedValue
    ExchangeRateResponse:
      type: object
      description: Exchange rate response
      properties:
        baseCurrency:
          type: string
          description: Base currency for conversion (currently only USD supported)
          example: USD
        targetCurrency:
          type: string
          description: Target currency for conversion (currently only THB supported)
          example: THB
        date:
          type: string
          format: date
          description: Date for the given rate
          example: '2025-11-02'
        rate:
          type: number
          description: Exchange rate for the given date
          example: 32.68
        publishedDate:
          type: string
          format: date
          description: Date the exchange rate was published.  FRED doesn't publish
            rates for weekends and holidays, so we use the nearest previously published
            rate
          example: '2025-10-31'
      required:
      - baseCurrency
      - date
      - publishedDate
      - rate
      - targetCurrency
    ImportResultResponse:
      type: object
      description: Import result response
      properties:
        newRecords:
          type: integer
          format: int32
          description: Number of new exchange rates created
          example: 10
        updatedRecords:
          type: integer
          format: int32
          description: Number of exchange rates that were updated due to having a
            different rate than what we have stored- should never happen, rates shouldn't
            change
          example: 32.68
        skippedRecords:
          type: integer
          format: int32
          description: Number of rows in the csv that already had matching exchange
            rates created in the database
          example: '2025-10-31'
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the import
          example: '2025-10-31'
      required:
      - newRecords
      - skippedRecords
      - timestamp
      - updatedRecords
